# benchmark_comm

Single-node
```
torchrun --standalone --nnodes=1 --nproc_per_node=8 test_dist.py --dtype bf16 -a all
```

Output:
```
==== Testing allreduce ====
+------------+-----------------+----------------+----------+-------------+-------------+
|  size(B)   | count(elements) |      type      | time(ms) | algbw(GB/s) | busbw(GB/s) |
+------------+-----------------+----------------+----------+-------------+-------------+
| 134217728  |     67108864    | torch.bfloat16 |   0.47   |    266.73   |    266.73   |
| 1207959552 |    603979776    | torch.bfloat16 |   3.60   |    312.65   |    312.65   |
+------------+-----------------+----------------+----------+-------------+-------------+
Average busbw: 289.689 GB/s
==== Testing allgather ====
+------------+-----------------+----------------+----------+-------------+-------------+
|  size(B)   | count(elements) |      type      | time(ms) | algbw(GB/s) | busbw(GB/s) |
+------------+-----------------+----------------+----------+-------------+-------------+
| 134217728  |     67108864    | torch.bfloat16 |   0.41   |    307.68   |    153.84   |
| 1207959552 |    603979776    | torch.bfloat16 |   3.18   |    353.54   |    176.77   |
+------------+-----------------+----------------+----------+-------------+-------------+
Average busbw: 165.305 GB/s
==== Testing allgather_t ====
+------------+-----------------+----------------+----------+-------------+-------------+
|  size(B)   | count(elements) |      type      | time(ms) | algbw(GB/s) | busbw(GB/s) |
+------------+-----------------+----------------+----------+-------------+-------------+
| 134217728  |     67108864    | torch.bfloat16 |   0.29   |    435.78   |    217.89   |
| 1207959552 |    603979776    | torch.bfloat16 |   2.18   |    516.13   |    258.07   |
+------------+-----------------+----------------+----------+-------------+-------------+
Average busbw: 237.979 GB/s
==== Testing reducescatter ====
+------------+-----------------+----------------+----------+-------------+-------------+
|  size(B)   | count(elements) |      type      | time(ms) | algbw(GB/s) | busbw(GB/s) |
+------------+-----------------+----------------+----------+-------------+-------------+
| 134217728  |     67108864    | torch.bfloat16 |   0.42   |    296.99   |    148.49   |
| 1207959552 |    603979776    | torch.bfloat16 |   3.19   |    352.29   |    176.15   |
+------------+-----------------+----------------+----------+-------------+-------------+
Average busbw: 162.320 GB/s
==== Testing reducescatter_t ====
+------------+-----------------+----------------+----------+-------------+-------------+
|  size(B)   | count(elements) |      type      | time(ms) | algbw(GB/s) | busbw(GB/s) |
+------------+-----------------+----------------+----------+-------------+-------------+
| 134217728  |     67108864    | torch.bfloat16 |   0.31   |    400.84   |    200.42   |
| 1207959552 |    603979776    | torch.bfloat16 |   2.31   |    487.27   |    243.64   |
+------------+-----------------+----------------+----------+-------------+-------------+
Average busbw: 222.028 GB/s
==== Testing alltoall ====
+------------+-----------------+----------------+----------+-------------+-------------+
|  size(B)   | count(elements) |      type      | time(ms) | algbw(GB/s) | busbw(GB/s) |
+------------+-----------------+----------------+----------+-------------+-------------+
| 134217728  |     67108864    | torch.bfloat16 |   0.25   |    497.46   |    248.73   |
| 1207959552 |    603979776    | torch.bfloat16 |   1.81   |    621.03   |    310.52   |
+------------+-----------------+----------------+----------+-------------+-------------+
Average busbw: 279.624 GB/s
==== Testing alltoall_single ====
+------------+-----------------+----------------+----------+-------------+-------------+
|  size(B)   | count(elements) |      type      | time(ms) | algbw(GB/s) | busbw(GB/s) |
+------------+-----------------+----------------+----------+-------------+-------------+
| 134217728  |     67108864    | torch.bfloat16 |   0.25   |    499.50   |    249.75   |
| 1207959552 |    603979776    | torch.bfloat16 |   1.81   |    621.35   |    310.68   |
+------------+-----------------+----------------+----------+-------------+-------------+
Average busbw: 280.214 GB/s

```
